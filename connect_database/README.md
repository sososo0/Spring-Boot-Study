# Connect Database 

애플리케이션은 데이터(리소스)를 주고받는 것이 목적이다. 

## ORM 

ORM은 Object Relational Mapping의 줄임말로 객체 관계 매핑을 의미한다. Java와 같은 객체 지향 언어에서 의미하는 객체와 RDB(Relational Database)의 테이블을 자동으로 매핑하는 방법이다. 
- 여기서의 객체지향 언어에서의 객체는 클래스를 의미한다. 
- 클래스는 데이터베이스의 테이블과 매핑하기 위해 만들어진 것이 아니기 때문에 RDB 테이블과 어쩔 수 없는 불일치가 존재한다. 
- ORM은 이 둘의 불일치와 제약사항을 해결하는 역할이다. 
  - ORM을 이용하면 쿼리문 작성이 아닌 코드(메서드)로 데이터를 조작할 수 있다. 

### ORM의 장점 

- ORM을 사용하면서 데이터베이스 쿼리를 객체지향적으로 조작할 수 있다. 
  - 쿼리문을 작성하는 양이 현저히 줄어 개발 비용이 줄어든다.
  - 객체지향적으로 데이터베이스에 접근할 수 있어 코드의 가독성을 높인다. 
- 재사용 및 유지보수가 편리하다.
  - ORM을 통해 매핑된 객체는 모두 독립적으로 작성되어 있어 재사용이 용이하다. 
  - 객체들은 각 클래스로 나뉘어 있어 유지보수가 수월하다. 
- 데이터베이스에 대한 종속성이 줄어든다. 
  - ORM을 통해 자동 생성된 SQL문은 객체를 기반으로 데이터베이스 테이블을 관리하기 때문에 데이터베이스에 종속적이지 않다. 
  - 데이터베이스를 교체하는 상황에서도 비교적 적은 리스크를 부담한다. 

### ORM의 단점 

- ORM만으로 온전한 서비스를 구현하기에는 한계가 있다. 
  - 복잡한 서비스의 경우 직접 쿼리를 구현하지 않고 코드로 구현하기 어렵다. 
  - 복잡한 쿼리를 정확한 설계 없이 ORM만으로 구성하게 되면 속도 저하 등의 성능 문제가 발생할 수 있다. 
- 애플리케이션의 객체 관점과 데이터베이스의 관계 관점의 불일치가 발생한다. 
  - 세분성(Granularity) : ORM의 자동 설계 방법에 따라 데이터베이스에 있는 테이블의 수와 애플리케이션의 엔티티 클래스의 수가 다른 경우가 생긴다. (클래스가 테이블의 수보다 많아질 수 있다.)
  - 상속성(Inheritance) : RDBMS에는 상속이라는 개념이 없다. 
  - 식별성(Identity) : RDBMS는 기본키(Primary Key)로 동일성을 정의한다. 하지만 자바는 두 객체의 값이 같아도 다르다고 판단할 수 있다. 식별과 동일성의 문제이다. 
  - 연관성(Associations) : 객체지향 언어는 객체를 참조함으로써 연관성을 나타내지만 RDBMS에서는 외래키를 삽입함으로써 연관성을 표현한다. 또한 객체지향 언어에서 객체를 참조할 때 방향성이 존재하지만 RDBMS에서 외래키를 삽입하는 것은 양방향의 관계를 가지기 때문에 방향성이 없다. 
  - 탐색(Navigation) : 자바와 RDBMS는 어떤 값(객체)에 접근하는 방식이 다르다. 자바에서는 특정 값에 접근하기 위해 객체 참조 같은 연결 수단을 활용한다. 이 방식은 객체를 연결하고 또 연결해서 접근하는 그래프 형태의 접근 방식이다. 반면 RDBMS에서는 쿼리를 최소화하고 조인을 통해 여러 테이블을 로드하고 값을 추출하는 접근 방식을 채택하고 있다. 

## JPA

JPA는 자바 진영의 ORM 기술 표준으로 채택된 인터페이스 모음이다. ORM이 큰 개념이라면 JPA는 더 구체화된 스펙을 포함한다. 
- 즉, JPA 또한 실제로 동작하는 것이 아니고 어떻게 동작해야 하는지 메커니즘을 정리한 표준 명세로 생각하면 된다. 

> JPA의 메커니즘을 보면 내부적으로 JDBC를 사용한다. 개발자가 직접 JDBC를 구현하면 SQL에 의존하게 되는 문제 등이 있어 개발의 효율성이 떨어지는데, JPA는 이 같은 문제점을 보완해서 개발자 대신 적절한 SQL을 생성하고 데이터베이스를 조작해서 객체를 자동 매핑하는 역할을 수행한다. 

JPA 기반의 구현체는 대표적으로 하이버네이트, 이클립스 링크, 데이터 뉴클리어스가 있으며, 이 중 많이 사용된느 구현체는 하이버네이트이다. 

## 하이버네이트 

하이버네이트는 자바의 ORM 프레임워크로, JPA가 정의하는 인터페이스를 구현하고 있는 JPA 구현체 중 하나이다. 

### Spring Data JPA 

Spring Data JPA는 JPA를 편리하게 사용할 수 있도록 지원하는 스프링 하위 프로젝트 중 하나이다. \
Spring Data JPA는 CRUD 처리에 필요한 인터페이스를 제공하며, 하이버네이트의 엔티티 매니저(Entity Manager)를 직접 다루지 않고 레포지토리를 정의해 사용함으로써 스프링이 적합한 쿼리를 동적으로 생성하는 방식으로 데이터베이스를 조작한다.

> 하이버네이트에서 자주 사용되는 기능을 더 쉽게 사용할 수 있도록 구현한 라이브러리이다. 

## 영속성 컨텍스트 

영속성 컨텍스트는 애플리케이션과 데이터베이스 사이에서 엔티티와 레코드의 괴리를 해소하는 기능과 객체를 보관하는 기능을 수행한다. 
- 엔티티 객체가 영속성 컨텍스트에 들어오면 JPA는 엔티티 객체의 매핑 정보를 데이터베이스에 반영하는 작업을 수행한다. 
- 이처럼 엔티티 객체가 영속성 컨텍스트에 들어와 JPA의 관리 대상이 되는 시점부터는 해당 객체를 영속 객체라고 부른다. 
- 영속성 컨텍스트는 세션 단위의 생명주기를 가진다. 
  - 데이터베이스에 접근하기 위한 세션이 생성되면 영속성 컨텍스트가 만들어지고, 세션이 종료되면 영속성 컨텍스트도 없어진다. 
- 엔티티 매니저는 이러한 일련의 과정에서 영속성 컨텍스트에 접근하기 위한 수단으로 사용된다. 
